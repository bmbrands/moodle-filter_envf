function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 * Add the form to the page
 *
 * @module      filter_envf/userprofileform.js
 * @package     filter_envf
 * @copyright   CALL Learning - Laurent David <laurent@call-learning.fr>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("filter_envf/userprofileform",["jquery","core/str","core/fragment","core/templates","core/ajax","core/notification"],(function($,Str,Fragment,Templates,Ajax,Notification){var UserForm=function(formelement,contextid,userid){this.formelementcontainer=formelement,this.contextid=contextid,this.userid=userid,formelement.on("submit","form",this.submitFormAjax.bind(this))},validUserFields=["id","username","auth","suspended","firstname","lastname","email","maildisplay","city","country","timezone","description","userpicture","firstnamephonetic","lastnamephonetic","middlename","alternatename","interests","url","icq","skype","aim","yahoo","msn","idnumber","institution","department","phone1","phone2","address","lang","calendartype","theme","mailformat","customfields","preferences"];return UserForm.prototype.submitFormAjax=function(e){e.preventDefault();var changeEvent=document.createEvent("HTMLEvents");changeEvent.initEvent("change",!0,!0);var formelement=$(this.formelementcontainer).find("form");formelement.find(":input").each((function(index,element){element.dispatchEvent(changeEvent)}));var invalid=$.merge(formelement.find('[aria-invalid="true"]'),formelement.find(".error"));if(invalid.length)invalid.first().focus();else{var formelementcontainer=this.formelementcontainer,params={jsonformdata:JSON.stringify(formelement.serialize())},userform=this;Fragment.loadFragment("filter_envf","userprofile_form",this.contextid,params).then((function(form,js){if(Templates.replaceNodeContents(formelementcontainer,form,js),formelementcontainer.children(".upf-userformvalidated").data("validated")){var formDataCombined=$(formelementcontainer.find("form")).serializeArray().reduce((function(acc,item){return validUserFields.includes(item.name)&&(acc[item.name]=item.value),acc}),{});void 0!==_typeof(formDataCombined.newpassword)&&delete formDataCombined.newpassword,void 0!==_typeof(formDataCombined.password)&&delete formDataCombined.password,Ajax.call([{methodname:"filter_envf_update_user",args:{userdata:formDataCombined},done:userform.handleFormSubmissionResponse.bind(userform,formDataCombined),fail:userform.handleFormSubmissionFailure.bind(userform,formDataCombined)}])}}))}},UserForm.prototype.handleFormSubmissionResponse=function(data){Str.get_string("userupdated","filter_envf",data).done((function(str){Notification.addNotification({message:str,type:"info"})}))},UserForm.prototype.handleFormSubmissionFailure=function(data){Str.get_string("userupdated","filter_envf",data).done((function(str){Notification.addNotification({message:str,type:"warning"})}))},{init:function(args){$(document).ready((function(){$("."+args.classmarker).each((function(){var userid=$(this).data("userid"),contextid=$(this).data("contextid"),currentform=$(this);Fragment.loadFragment("filter_envf","userprofile_form",contextid,{}).then((function(form,js){Templates.replaceNodeContents(currentform,form,js),new UserForm(currentform,contextid,userid)}))}))}))}}}));

//# sourceMappingURL=userprofileform.min.js.map